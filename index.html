<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integrated Inductance Analysis Tool</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body data-theme="light">
        <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1 class="page-title">🚀 Inductance Analysis Tool</h1>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                ☀️
            </button>
        </div>
    </header>

    <main class="container">
                <div class="card animate-in">
            <h2 class="card-title">Step 1: Paste Raw Data</h2>
            <textarea id="rawInput" class="input-field" style="height: 250px; font-family: 'Courier New', monospace; font-size: 12px;">
BLOCK: CLC_6x22x4.1R1, N: 40(6T_0.1x50p)								
Idc(A)	139	140	141	143	144	145	146	147
0	128.3	127.2	118.8	130.7	134.2	133.1	132.6	132.9
10	109.1	111.3	102.3	112.6	118	116.9	116.7	116.9
13.5	98.8	103.1	93.5	104	109.8	108.7	108.7	108.6
14.5	95.8	100.7	90.9	101.7	107.5	106.4	106.3	106.3
15	94.4	99.4	89.7	100.5	106.3	105.3	105.2	105.3
Gap(mm)	3.1	3.1	4.1	3.1	3.1	3.1	3.1	3.1
L_initial	131.1	130	121.1	133.8	137.4	136.2	135.6	136
								
BLOCK: CLC_6x22x4.1R0, N: 40(6T_0.1x50p)								
Idc(A)	139	140	141	143	144	145	146	147
0	130.5	129.9	121	136.1	136.9	135.8	135.3	135.6
10	110.2	113.3	103.7	116.1	119.5	118.6	118.4	118.5
13.5	99.2	104.4	94.4	106.3	110.8	109.9	109.9	109.8
14.5	96.1	101.8	91.6	103.5	108.4	107.3	107.4	107.3
15	94.7	100.4	90.2	101.9	106.8	106	106.2	106
Gap(mm)	3.1	3.1	4.1	3.1	3.1	3.1	3.1	3.1
L_initial	133.9	132.9	123.4	139.3	140.1	139	138.4	138.9
</textarea>
            <div style="text-align: center; margin-top: 20px;">
                <button id="processBtn" class="btn btn-full">📊 Process and Analyze Data</button>
            </div>
            <div id="processingErrors" class="processing-errors"></div>
        </div>

                <textarea id="dataInput" class="hidden"></textarea>

                <div id="rawCurveChartContainer" class="card hidden animate-in">
            <h2 class="card-title">Raw L-I Curve Chart (Idc vs. Inductance)</h2>
            <div class="chart-wrapper" style="height: 450px;">
                <canvas id="rawCurveChart"></canvas>
            </div>
        </div>

                <div id="analysisContainer" class="hidden animate-in">
            <hr class="divider">
            <div class="hero" style="margin-bottom: 2rem;">
                <h1>Step 2: Analysis Results</h1>
            </div>

                        <div class="card">
                <h2 class="card-title">Parsed Data Confirmation</h2>
                <div id="dataCount" class="data-count">Waiting for data...</div>
                <div class="table-wrapper">
                    <table class="stats-table" id="parsedDataTable">
                        <thead>
                            <tr>
                                <th>Center Leg</th><th>Outer Shell</th><th>L_initial(uH)</th><th>Idc_70%(A)</th><th>Idc_80%(A)</th><th>Gap(mm)</th><th>N</th><th>FoM</th>
                            </tr>
                        </thead>
                        <tbody id="parsedDataTableBody"></tbody>
                    </table>
                </div>
            </div>

                        <div class="grid grid-2">
                <div class="card">
                    <h2 class="card-title">Center Leg Core Filter</h2>
                    <div class="filter-actions">
                        <button class="btn-filter" id="selectAllCenterLegs">Select All</button>
                        <button class="btn-filter" id="deselectAllCenterLegs">Deselect All</button>
                    </div>
                    <div class="filter-controls" id="centerLegFilterControls"></div>
                </div>
                <div class="card">
                    <h2 class="card-title">Outer Core Shell Filter</h2>
                    <div class="filter-actions">
                        <button class="btn-filter" id="selectAllOuterCores">Select All</button>
                        <button class="btn-filter" id="deselectAllOuterCores">Deselect All</button>
                    </div>
                    <div class="filter-controls" id="outerCoreFilterControls"></div>
                </div>
            </div>

                        <div class="card">
                <h2 class="card-title">Analysis Options</h2>
                <div class="grid grid-2">
                    <div class="input-group">
                        <label for="xAxis" class="input-label">X-Axis</label>
                        <select id="xAxis" class="input-field">
                            <option value="Idc_80">Idc 80% (A)</option>
                            <option value="Idc_70">Idc 70% (A)</option>
                            <option value="L_initial">Inductance (μH)</option>
                            <option value="FoM">FoM (L×Idc)</option>
                            <option value="Gap">Gap (mm)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="yAxis" class="input-label">Y-Axis</label>
                        <select id="yAxis" class="input-field">
                            <option value="L_initial">Inductance (μH)</option>
                            <option value="Idc_80">Idc 80% (A)</option>
                            <option value="Idc_70">Idc 70% (A)</option>
                            <option value="FoM">FoM (L×Idc)</option>
                            <option value="Gap">Gap (mm)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <button class="btn btn-secondary btn-full" id="btnExportCSV">Export Selected Data to CSV</button>
                    </div>
                    <div class="input-group">
                        <button class="btn btn-secondary btn-full" id="btnExportPNG">Export Chart to PNG</button>
                    </div>
                </div>
            </div>

                        <div class="card">
                <h2 class="card-title">Analysis Chart (Summary)</h2>
                <div class="chart-wrapper" style="height: 500px;">
                    <canvas id="mainChart"></canvas>
                    <div id="chartStatus">Loading...</div>
                </div>
            </div>

                        <div class="card">
                <h2 class="card-title">Statistics Summary (Based on selected data)</h2>
                <div class="table-wrapper" style="max-height: none;">
                    <table class="stats-table" id="statsTable">
                        <thead>
                            <tr><th>Group (Center Leg)</th><th>Count</th><th>L Avg (μH)</th><th>Idc_70% Avg (A)</th><th>Idc_80% Avg (A)</th><th>FoM Avg</th><th>Gap Avg (mm)</th></tr>
                        </thead>
                        <tbody id="statsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

        <script>
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        themeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '🌙';
            } else {
                body.setAttribute('data-theme', 'light');
                themeToggle.textContent = '☀️';
            }
        });
    </script>
        <script src="script.js"></script>
</body>
</html>
